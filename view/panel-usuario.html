<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge;chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Panel usuario</title>

    <%- include ('partials/head.html'); -%>
        <script src="https://code.iconify.design/1/1.0.7/iconify.min.js"></script>
</head>

<body class="pagina-centrada">

    <div class="container" style="height: 100%;">
        <div class="row" style="height: 100%;">
            <div class="col-sm-10 col-md-10 col-lg-8 mx-auto my-auto">
                <div class="card card-signin">
                    <div class="card-body">

                        <div class="text-center">
                            <h6 id="html-texto-logo" style="display: none; font-size: 60%;">*Haz click en la imagen para
                                cambiar el LOGO</h6>
                        </div>
                        <div style="cursor: pointer;" class="text-center" onclick="Funcion_Modificar_LOGO()">
                            <img src="/logos/<%= datos.logo %>" height="100px" width="250px">
                        </div>

                        <div id="spinner" style="display: none;" class="mt-3">
                            <div class="d-flex justify-content-center">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="sr-only">Loading...</span>
                                </div>
                            </div>
                        </div>

                        <H2 class="text-center mt-4 mb-2">Panel usuario</H2>

                        <div class="mt-3" style="font-size: 90%;">
                            <span style="font-size: 110%;" class="iconify" data-icon="clarity:id-badge-solid"></span>
                            <span class="">Mi token: <%= datos.id %></span>
                        </div>

                        <form class="form-signin mb-3 text-center mt-3">
                            <div class="row m-0">
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mx-auto mt-2 mt-lg-0">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/registro-dispositivo'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="si-glyph:cashier-machine"></span>
                                        Agregar dispositivo</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mx-auto mt-4 mt-md-2 mt-lg-0">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/dispositivos'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="bi:clipboard-data"></span>
                                        Dispositivos</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/registro-estancia'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="vaadin:workplace"></span>
                                        Agregar estancia</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/estancias'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="bi:clipboard-data"></span>
                                        Estancias</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/registro-variable'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="si-glyph:light-bulb"></span>
                                        Añadir variables</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/variables'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="bi:clipboard-data"></span>
                                        Variables</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/registro-widget'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="file-icons:dashboard"></span>
                                        Añadir widget</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/widgets'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="bi:clipboard-data"></span>
                                        Widgets</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/registro-evento'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="carbon:notification-filled"></span>
                                        Añadir evento</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;"
                                        onclick="window.location='/eventos'">
                                        <span style="font-size: 140%;" class="iconify mr-1"
                                            data-icon="bi:clipboard-data"></span>
                                        Eventos</button>
                                </div>

                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button id="btn-cerrar-sesion" type="button" class="btn btn-danger btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;">
                                        <span class='iconify mr-1' data-icon='codicon:sign-out'
                                            style='font-size: 140%;'></span>
                                        Cerrar sesión</button>
                                </div>
                                <div class="col-12 col-sm-9 col-md-6 col-lg-6 mt-4 mx-auto">
                                    <button id="btn-tablero" type="button" class="btn btn-primary btn-lg px-4"
                                        style="border-radius: 5rem;  transition: all 0.2s; width: 240px;">
                                        <span class='iconify mr-1' data-icon='ant-design:dashboard-outlined'
                                            style='font-size: 140%;'></span>
                                        Tablero
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <%- include ('partials/footer.html'); -%>

        <!--Configuracion de notificacion web-push-->
        <script src="/conf-web-push.js"></script>

        <script>
            window.usuario = '<%= datos.id %>'
            window.permiso_edicion = '<%= datos.permiso_edicion %>'

            if (window.permiso_edicion == 1) {
                document.getElementById("html-texto-logo").style.display = "block";
            }

            function Funcion_Modificar_LOGO() {
                if (window.permiso_edicion == 1) {
                    $.confirm({
                        title: 'Cambiar LOGO',
                        content: '' +
                            '<form id="form" enctype="multipart/form-data"' +
                            '<div class="form-group">' +
                            '<input style="display: none;" type="text" name="id_usuario" value="<%= datos.id %>" placeholder="" required autofocus>' +
                            '</div>' +
                            '<div class="form-group">' +
                            '<input type="file" name="input-logo" accept="image/png, image/jpeg" class="form-control" placeholder="LOGO" required autofocus>' +
                            '</div>' +
                            '</form>',
                        buttons: {
                            formSubmit: {
                                text: 'Aceptar',
                                btnClass: 'btn-blue',
                                action: function () {
                                    document.getElementById("spinner").style.display = "block"
                                    var formData = new FormData(document.getElementById("form"));
                                    $.ajax({
                                        url: "modificacion-logo",
                                        type: "post",
                                        dataType: "html",
                                        data: formData,
                                        cache: false,
                                        contentType: false,
                                        processData: false
                                    }).done(function (res) {
                                        console.log(res)
                                        respuesta = res;
                                        if (respuesta == "Modificado") {
                                            $.alert('' +
                                                '<label>LOGO modificado exitosamente. Cierra y abre sesión para ver los cambios</label>' +
                                                '<div class="text-center">' +
                                                '<i class="fas fa-check fa-4x"></i>' +
                                                '</div>');
                                        }
                                        if (respuesta == "Error") {
                                            $.alert('' +
                                                '<label>Error al modificar</label>' +
                                                '<div class="text-center">' +
                                                '<i class="fas fa-times fa-4x"></i>' +
                                                '</div>');
                                        }
                                        document.getElementById("spinner").style.display = "none"
                                    });
                                }
                            },
                            Cancelar: {},
                        },
                        onContentReady: function () {
                            var jc = this;
                            this.$content.find('form').on('submit', function (e) {
                                e.preventDefault();
                                jc.$$formSubmit.trigger('click');
                            });
                        }
                    });
                }
            }

            $("#btn-tablero").click(function () {
                window.location.href = "/tablero";
            });

            $("#btn-cerrar-sesion").click(function () {
                $.post("/cerrar-sesion", function (res) {
                    console.log(res)
                    respuesta = res;
                    if (respuesta == "ok")
                        window.location.href = "/";
                });
            });

            $(document).ready(function () {
                var height = $(window).height();
                $('.pagina-centrada').height(height);
            });

            // Para detectar cambio de pantalla
            $(window).resize(function () {
                var height = $(window).height();
                $('.pagina-centrada').height(height);
            });
        </script>

</body>

</html>